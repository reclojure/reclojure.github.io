{"version":3,"sources":["portal/runtime/web/client.cljs"],"mappings":";AAGA,GAAA,QAAAA,mCAAAC,2CAAAC,+CAAAC,sDAAAC;AAAA;AAAA,AAAA,oCAAA,2CAAA,kEAAA,iGAAA,lPAASC,qTAAuC,6CAAA,7CAACC;;AAEjD,oCAAA,pCAAMC,gFAASC,eAAeC;AAA9B,AACE,IAAAC,qBAAA,AAAAC,gBAAuBH;AAAvB,AAAA,oBAAAE;AAAA,mBAAAA,fAASE;AAAT,AACE,OAACC,oBACA,AAA4BD,mCAAa,AAACE,qBAASL,QAAQJ,oCAC3DA;;AACD,MAAO,gDAAA,hDAACU,kEAA0BN;;;AAEtC,uCAAA,vCAAOO,sFAAYC,QAAQC;AAA3B,AACE,0CAAA,2CAAA,kDAAA,qFAAA,5NAACX,kCAAQU,kPAA2CC;;AACpD,6DAAA,7DAACC,8JAAwBD;;AACzBA;;AAEF,AAAA;;;;;;;;;;;;AAAA,AAAA,CAAA,AAAA,6EAAA,7EAASM,wFAEEE;;AAFX,AAAA,gBAAA,ZAEWA;AAFX,AAEkB,sDAAA,AAAAf,yCAAA,mFAAA,iGAAA,5QAACgB,+DAAQC;;;AAF3B,CAAA,AAAA,mFAAA,nFAASJ,8FAIGE,MAAMR;;AAJlB,AAAA,gBAAA,ZAIYQ;AAJZ,AAI6B,OAACV,qCAAWC,eAAQC;;;AAJjD,CAAA,AAAA,iFAAA,jFAASM,4FAMEK,MAAKC;;AANhB,AAAA,gBAAA,ZAMWD;AANX,AAOI,OAACE,sBAAOF,UAAK,iBAAAG,WAAA,AAAArB,gBAAIkB;AAAJ,AAAA,0EAAAG,wBAAAA,1FAACF,kCAAAA,4CAAAA;;;;AAPlB,CAAA,AAAA,iFAAA,jFAASN,4FAQEK,MAAKC,EAAEG;;AARlB,AAAA,gBAAA,ZAQWJ;AARX,AASI,OAACE,sBAAOF,UAAK,iBAAAK,WAAA,AAAAvB,gBAAIkB;IAAJM,WAASF;AAAT,AAAA,0EAAAC,SAAAC,wBAAAD,SAAAC,5GAACL,kCAAAA,qDAAAA;;;;AATlB,CAAA,AAAA,iFAAA,jFAASN,4FAUEK,MAAKC,EAAEG,EAAEG;;AAVpB,AAAA,gBAAA,ZAUWP;AAVX,AAWI,OAACE,sBAAOF,UAAK,iBAAAQ,WAAA,AAAA1B,gBAAIkB;IAAJS,WAASL;IAATM,WAAWH;AAAX,AAAA,0EAAAC,SAAAC,SAAAC,wBAAAF,SAAAC,SAAAC,9HAACT,kCAAAA,8DAAAA;;;;AAXlB,CAAA,AAAA,iFAAA,jFAASN,4FAYEK,MAAKC,EAAEG,EAAEG,EAAEI;;AAZtB,AAAA,gBAAA,ZAYWX;AAZX,AAaI,OAACE,sBAAOF,UAAK,gDAAA,AAAAlB,hDAAC8B,8CAAMX,kBAAGD,WAAKI,EAAEG,EAAEI;;;AAbpC,CAAA,4CAAA,5CAAShB;AAAT,AAAA,AAAA;;;AAAA,CAAA,kDAAA,lDAASA;;AAAT,CAAA,qDAAA,rDAASA;;AAAT,CAAA,0DAAA,WAAAJ,mBAAAC,qBAAAC,7GAASE;AAAT,AAAA,OAAAD,iBAAAF,qBAAA;;;AAAA;;;wCAAA,xCAASI,wFAAQR;AAAjB,AAAA,YAAAO,iCAAiBP;;;AAARO,AAeT,sCAAA,tCAAMkB,oFAAWzB;AAAjB,AAA0B,YAAAO,iCAASP","names":["js/portal","js/portal.runtime","js/portal.runtime.web","js/portal.runtime.web.client","js/portal.runtime.web.client.session","portal.runtime.web.client/session","cljs.core.atom","portal.runtime.web.client/request","session-handle","message","temp__5751__auto__","cljs.core/deref","child-window","portal.runtime/read","portal.runtime/write","cljs.core.ex_info","portal.runtime.web.client/push-state","session","new-value","portal.runtime.update_selected","this__4461__auto__","writer__4462__auto__","opt__4463__auto__","cljs.core/-write","portal.runtime.web.client/Portal","portal.runtime.web.client/->Portal","_this","cljs.core.get_in","portal.runtime/sessions","this","f","cljs.core/reset!","G__56746","a","G__56749","G__56752","b","G__56763","G__56764","G__56765","xs","cljs.core.apply","portal.runtime.web.client/make-atom"],"sourcesContent":["(ns portal.runtime.web.client\n  (:require [portal.runtime :as rt]))\n\n(defonce session {:session-id ::id :value-cache (atom {})})\n\n(defn request [session-handle message]\n  (if-let [child-window @session-handle]\n    (rt/read\n     (.portal.ui.rpc.handler ^js child-window (rt/write message session))\n     session)\n    (throw (ex-info \"Portal not open\" message))))\n\n(defn- push-state [session new-value]\n  (request session {:op :portal.rpc/push-state :state new-value})\n  (rt/update-selected ::id new-value)\n  new-value)\n\n(deftype Portal [session]\n  IDeref\n  (-deref [_this] (get-in @rt/sessions [::id :selected]))\n  IReset\n  (-reset! [_this new-value] (push-state session new-value))\n  ISwap\n  (-swap! [this f]\n    (reset! this (f @this)))\n  (-swap! [this f a]\n    (reset! this (f @this a)))\n  (-swap! [this f a b]\n    (reset! this (f @this a b)))\n  (-swap! [this f a b xs]\n    (reset! this (apply f @this a b xs))))\n\n(defn make-atom [session] (Portal. session))\n\n"]}